---

import resume from '../../public/resume.pdf';
---

<div
  class='mobile-menu fixed right-0 top-0 z-50 flex h-screen w-1/2 translate-x-full flex-col bg-black text-right text-white md:hidden'
  id='mobile-menu'
  role='navigation'
  aria-label='Mobile navigation'
  inert
>
  <!-- Close Button Row - mirrors header structure -->
  <div class='flex flex-row items-center justify-end p-4 h-[80px]'>
    <button
      type='button'
      aria-label='Close navigation menu'
      class='bg-transparent'
      id='close-menu'
      tabindex="-1"
    >
      <span aria-hidden='true' class='relative h-6 w-6 flex items-center justify-center bg-transparent'>
        <!-- Diagonal Line 1 -->
        <span class='absolute h-1 w-6 rotate-45 bg-[#FAF8F3]'></span>
        <!-- Diagonal Line 2 -->
        <span class='absolute h-1 w-6 -rotate-45 bg-[#FAF8F3]'></span>
      </span>
    </button>
  </div>
  <div class='flex flex-col gap-10 px-4'>
  <!-- Menu Links -->
  <a
    class='menu-link w-min ml-auto text-xl font-bold tracking-widest text-[#FAF8F3]'
    href='/'
    tabindex="-1"
  >work</a
  >
  <a
    class='menu-link w-min ml-auto text-xl font-bold tracking-widest text-[#FAF8F3]'
    href='/about'
    tabindex="-1"
  >about</a
  >
  <a
    class='menu-link w-min ml-auto text-xl font-bold tracking-widest text-[#FAF8F3]'
    target='_blank'
    href={resume}
    tabindex="-1"
  >resume</a
  >
  <a
    class='menu-contact w-min ml-auto flex min-w-12 items-center gap-2 rounded-sm px-4 py-2 border-2 bg-black text-white border-white text-[12px] font-bold uppercase tracking-widest'
    href='mailto:joe.ngyn7@gmail.com'
    tabindex="-1"
  >
    Contact
  </a>
  <!-- Dark Mode Toggle -->
  <button
    id='theme-toggle-mobile'
    type='button'
    aria-label='Toggle dark mode'
    class='ml-auto flex h-10 w-10 items-center justify-center'
    tabindex="-1"
  >
    <!-- Sun Icon (visible in light mode) -->
    <svg
      id='sun-icon-mobile'
      class='h-6 w-6'
      fill='none'
      stroke='currentColor'
      viewBox='0 0 24 24'
      xmlns='http://www.w3.org/2000/svg'
    >
      <path
        stroke-linecap='round'
        stroke-linejoin='round'
        stroke-width='2'
        d='M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z'
      ></path>
    </svg>
    <!-- Moon Icon (visible in dark mode) -->
    <svg
      id='moon-icon-mobile'
      class='hidden h-6 w-6'
      fill='none'
      stroke='currentColor'
      viewBox='0 0 24 24'
      xmlns='http://www.w3.org/2000/svg'
    >
      <path
        stroke-linecap='round'
        stroke-linejoin='round'
        stroke-width='2'
        d='M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z'
      ></path>
    </svg>
  </button>
  </div>
</div>

<div class='fixed inset-0 md:hidden' id='menu-overlay' inert style='z-index: 49;'></div>

<style>
  /* Menu overlay blur */
  #menu-overlay {
    background-color: rgba(0, 0, 0, 0);
    backdrop-filter: blur(0px);
    transition: background-color 400ms cubic-bezier(0.4, 0, 0.2, 1), backdrop-filter 400ms cubic-bezier(0.4, 0, 0.2, 1);
    pointer-events: none;
  }

  #menu-overlay.menu-open {
    background-color: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(8px);
    pointer-events: auto;
  }

  /* Mobile menu is always dark background, so always use light text */
  .mobile-menu {
    color: #FAF8F3 !important; /* white */
    transition: transform 400ms cubic-bezier(0.4, 0, 0.2, 1);
  }

  .mobile-menu .menu-link {
    color: #FAF8F3 !important; /* white - override any global styles */
    transition: opacity 300ms ease-out, transform 300ms cubic-bezier(0.4, 0, 0.2, 1);
    transform: translateX(20px);
    opacity: 0;
  }

  /* Animate menu links when menu is open */
  .mobile-menu:not(.translate-x-full) .menu-link {
    transform: translateX(0);
    opacity: 1;
  }

  /* Stagger animation for each menu link */
  .mobile-menu .menu-link:nth-child(1) {
    transition-delay: 100ms;
  }

  .mobile-menu .menu-link:nth-child(2) {
    transition-delay: 150ms;
  }

  .mobile-menu .menu-link:nth-child(3) {
    transition-delay: 200ms;
  }

  .mobile-menu a {
    color: #FAF8F3 !important; /* white - catch all links */
  }

  /* Close button X lines */
  #close-menu span.absolute {
    background-color: #FAF8F3; /* white */
    transition: opacity 300ms cubic-bezier(0.4, 0, 0.2, 1);
    opacity: 0;
  }

  /* Animate close button X when menu is open */
  .mobile-menu:not(.translate-x-full) #close-menu span.absolute {
    opacity: 1;
  }

  /* Contact button animation */
  .menu-contact {
    transition: opacity 300ms ease-out, transform 300ms cubic-bezier(0.4, 0, 0.2, 1);
    transform: translateX(20px);
    opacity: 0;
  }

  .mobile-menu:not(.translate-x-full) .menu-contact {
    transform: translateX(0);
    opacity: 1;
    transition-delay: 250ms;
  }

  /* Theme toggle button animation */
  #theme-toggle-mobile {
    transition: opacity 300ms ease-out, transform 300ms cubic-bezier(0.4, 0, 0.2, 1);
    transform: translateX(20px);
    opacity: 0;
  }

  .mobile-menu:not(.translate-x-full) #theme-toggle-mobile {
    transform: translateX(0);
    opacity: 1;
    transition-delay: 300ms;
  }

  .menu-link:focus-visible {
    outline: 2px solid #FAF8F3; /* white */
    outline-offset: 4px;
    border-radius: 2px;
  }

  .menu-contact:focus-visible {
    outline: 2px solid #FAF8F3; /* white */
    outline-offset: 4px;
  }

  #close-menu:focus-visible {
    outline: 2px solid #FAF8F3; /* white */
    outline-offset: 2px;
    border-radius: 2px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
</style>

<script>
  function initializeMobileMenu() {
    const closeMenu = document.getElementById('close-menu');
    const menu = document.querySelector('.mobile-menu');
    const menuButton = document.querySelector('.menu-button');
    const menuOverlay = document.getElementById('menu-overlay');

    function closeMobileMenu() {
      if (menu) {
        menu.setAttribute('inert', '');
        menu.classList.add('translate-x-full');
      }
      if (menuOverlay) {
        menuOverlay.classList.remove('menu-open');
      }
      if (menuButton) {
        menuButton.setAttribute('aria-expanded', 'false');
      }
      // Re-enable scroll
      document.body.style.overflow = '';
    }

    // Close on X Click
    if (closeMenu) {
      closeMenu.addEventListener('click', closeMobileMenu);
    }

    // Close on Link Click
    const menuLinks = document.querySelectorAll('.menu-link');
    if (menuLinks) {
      menuLinks.forEach((link) => {
        link.addEventListener('click', closeMobileMenu);
      });
    }

    // Close on Overlay Click
    if (menuOverlay) {
      menuOverlay.addEventListener('click', closeMobileMenu);
    }

    // Close on Outside Click
    if (menu) {
      document.addEventListener('click', (event) => {
        const target = event.target;
        if (!menuButton) {
          console.warn('Menu button not found');
          return;
        }

        if (
          target instanceof Element &&
          !menu.contains(target) &&
          !menuButton.contains(target) &&
          target !== menuOverlay
        ) {
          closeMobileMenu();
        }
      });
    }

    // Close on Escape key
    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape' && menu) {
        const isOpen = !menu.classList.contains('translate-x-full');
        if (isOpen) {
          closeMobileMenu();
        }
      }
    });

    // Dark Mode Toggle (Mobile)
    // Note: Theme application and icon syncing on page load is handled in Layout.astro
    const themeToggleMobile = document.getElementById('theme-toggle-mobile');

    if (themeToggleMobile) {
      themeToggleMobile.addEventListener('click', () => {
        const html = document.documentElement;
        const isDark = html.classList.contains('dark');
        const sunIcon = document.getElementById('sun-icon');
        const moonIcon = document.getElementById('moon-icon');
        const sunIconMobile = document.getElementById('sun-icon-mobile');
        const moonIconMobile = document.getElementById('moon-icon-mobile');

        if (isDark) {
          // Switch to light mode
          html.classList.remove('dark');
          sunIcon?.classList.remove('hidden');
          moonIcon?.classList.add('hidden');
          sunIconMobile?.classList.remove('hidden');
          moonIconMobile?.classList.add('hidden');
          localStorage.setItem('theme', 'light');
        } else {
          // Switch to dark mode
          html.classList.add('dark');
          sunIcon?.classList.add('hidden');
          moonIcon?.classList.remove('hidden');
          sunIconMobile?.classList.add('hidden');
          moonIconMobile?.classList.remove('hidden');
          localStorage.setItem('theme', 'dark');
        }
      });
    }
  }

  // Initialize on page load
  initializeMobileMenu();

  // Re-initialize after view transitions
  document.addEventListener('astro:after-swap', initializeMobileMenu);
</script>
